define("taoEventLog/controller/routes",[],function(){"use strict";return{TaoEventLog:{actions:{index:"controller/TaoEventLog/show"}}}}),define("tpl!taoEventLog/controller/TaoEventLog/show/layout",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){if(Object.prototype.hasOwnProperty.call(parent,propertyName))return parent[propertyName]};return'\n                    <div class="grid-row">\n                        <div class="col-12">\n                            <strong>'+container.escapeExpression("function"==typeof(helper=null!=(
helper=lookupProperty(helpers,"title")||(null!=depth0?lookupProperty(depth0,"title"):depth0))?helper:container.hooks.helperMissing)?helper.call(null!=depth0?depth0:container.nullContext||{},{name:"title",hash:{},data:data,loc:{start:{line:27,column:36},end:{line:27,column:45}}}):helper)+'</strong>\n                        </div>\n                    </div>\n                    <div class="grid-row">\n                        <div class="col-10 desc">\n                            <span class="'+container.escapeExpression("function"==typeof(helper=null!=(helper=lookupProperty(helpers,"key")||(null!=depth0?lookupProperty(depth0,"key"):depth0)
)?helper:container.hooks.helperMissing)?helper.call(null!=depth0?depth0:container.nullContext||{},{name:"key",hash:{},data:data,loc:{start:{line:32,column:41},end:{line:32,column:48}}}):helper)+'"></span>\n                        </div>\n                    </div>\n\n'},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){if(Object.prototype.hasOwnProperty.call(parent,propertyName))return parent[propertyName]};
return'<div class="log">\n    <div class="grid-row">\n        <div class="col-12">\n            <section class="log-browser">\n                <header>\n                    <h2>'+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"Log watcher",{name:"__",hash:{},data:data,loc:{start:{line:6,column:24},end:{line:6,column:44}}}))+'</h2>\n                    <div class="header-buttons">\n                        <button class="btn-info export js-export"><span class="icon-export"></span>'+container.escapeExpression((lookupProperty(helpers,
"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"Export log entries",{name:"__",hash:{},data:data,loc:{start:{line:8,column:99},end:{line:8,column:126}}}))+'</button>\n                    </div>\n                </header>\n                <div class="log-table-filters"></div>\n                <div class="log-table"></div>\n            </section>\n        </div>\n        <div class="col-5">\n            <section class="event-viewer hidden">\n                <div class="grid-row">\n                    <div class="col-10">\n                        <h3>'+container.escapeExpression((
lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"Event",{name:"__",hash:{},data:data,loc:{start:{line:19,column:28},end:{line:19,column:42}}}))+' #<span class="id"></span></h3>\n                    </div>\n                </div>\n\n'+(null!=(helpers=lookupProperty(helpers,"each").call(null!=depth0?depth0:container.nullContext||{},null!=depth0?lookupProperty(depth0,"dataTypes"):depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:23,column:16},end:{line:36,column:25}}}))?helpers:""
)+"\n            </section>\n        </div>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoEventLog/components/export/templates/layout",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){if(Object.prototype.hasOwnProperty.call(parent,propertyName))return parent[propertyName]};return'<div class="mp-export-modal">\n    <h1>'+container.escapeExpression("function"==typeof(helper=null!=(helper=lookupProperty(helpers,"title")||(null!=depth0?lookupProperty(depth0,"title"):depth0)
)?helper:container.hooks.helperMissing)?helper.call(null!=depth0?depth0:container.nullContext||{},{name:"title",hash:{},data:data,loc:{start:{line:2,column:8},end:{line:2,column:17}}}):helper)+'</h1>\n    <form class="grid-row js-export-form">\n        <div class="col-12">\n            <h2>'+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"CSV Options",{name:"__",hash:{},data:data,loc:{start:{line:5,column:16},end:{line:5,column:36}}})
)+'</h2>\n            <div class="grid-row">\n                <label class="col-5" for="field_delimiter">'+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"Field delimiter",{name:"__",hash:{},data:data,loc:{start:{line:7,column:59},end:{line:7,column:83}}}))+'</label>\n                <input class="col-7" name="field_delimiter" id="field_delimiter" size="2" value=";" type="text">\n            </div>\n            <div class="grid-row">\n                <label class="col-5" for="field_encloser">'+container.escapeExpression((
lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"Field encloser",{name:"__",hash:{},data:data,loc:{start:{line:11,column:58},end:{line:11,column:81}}}))+'</label>\n                <input class="col-7" name="field_encloser" size="2" value=\'"\' type="text">\n            </div>\n            <div class="grid-row">\n                <label class="col-5" for="multi_values_delimiter">'+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},
"Multiple values delimiter",{name:"__",hash:{},data:data,loc:{start:{line:15,column:66},end:{line:15,column:100}}}))+'</label>\n                <input class="col-7" name="multi_values_delimiter" size="2" value=\'|\' type="text">\n            </div>\n            <label class="grid-row">\n                <div class="col-5">'+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"First row column names",{name:"__",hash:{},data:data,loc:{start:{line:19,column:35},end:{line:19,column:66}}})
)+'</div>\n                <div class="col-7">\n                    <input type="checkbox" name="first_row_column_names" checked>\n                    <span class="icon-checkbox"></span>\n                </div>\n            </label>\n            <button type="submit" class="btn-success"><span class="icon-upload"></span>'+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null!=depth0?depth0:container.nullContext||{},"Export",{name:"__",hash:{},data:data,loc:{start:{line:25,column:87},end:{line:25,column:102}}}))+"</button>\n        </div>\n    </form>\n</div>"},useData:!0})}),
define("taoEventLog/components/export/exporter",["jquery","lodash","i18n","ui/component","ui/feedback","layout/loading-bar","tpl!taoEventLog/components/export/templates/layout","util/url","layout/logout-event","jquery.fileDownload"],function($,_,__,component,feedback,loadingBar,layoutTpl,url,logoutEvent){"use strict";return function(options){if(_.isPlainObject(options)&&_.isString(options.exportUrl))return component({},{title:__("Export")}).setTemplate(layoutTpl).on("render",function(){var self=this,$form=self.$component.find(".js-export-form");$form.on("submit",function(e){e.preventDefault(),loadingBar.start();var params={};_.each($form.serializeArray(),
function(param){params[param.name]=param.value}),e=url.build(options.exportUrl,params),$.fileDownload(e,{successCallback:function(){loadingBar.stop(),self.$component.modal("close")},failCallback:function(jqXHR){loadingBar.stop();jqXHR=$.parseJSON($(jqXHR).text());jqXHR?feedback().error(new Error(jqXHR.message)):(self.$component.modal("close"),logoutEvent())}})})}).init(options);throw new TypeError("The exporter must be configured with exportUrl option")}}),define("taoEventLog/components/export/modalExporter",["jquery","lodash","i18n","ui/feedback","taoEventLog/components/export/exporter","ui/modal"],function($,_,__,feedback,exporter){"use strict";
return function(options){var feedbackOptions={timeout:{warning:8e3},encodeHtml:!1};return exporter(options).on("warning",function(err){feedback().warning(err,feedbackOptions)}).on("error",function(err){feedback().error(err,feedbackOptions)}).on("render",function(){var self=this;this.$component.addClass("modal").on("close.modal",function(){self.$component.modal("close")}).modal({width:600})}).render("body")}}),define("taoEventLog/controller/TaoEventLog/show",["jquery","lodash","i18n","util/url","ui/datatable","tpl!taoEventLog/controller/TaoEventLog/show/layout","taoEventLog/components/export/modalExporter","ui/dateRange/dateRange"],function($,_,__,url,
datatable,layoutTpl,exporter,dateRangeFactory){"use strict";var listUrl=url.route("search","TaoEventLog","taoEventLog");return{start:function(){var data={dataTypes:[{key:"event_name",title:__("Event Name")},{key:"action",title:__("Action")},{key:"user_id",title:__("User ID")},{key:"user_roles",title:__("User Roles")},{key:"occurred",title:__("Occurred")},{key:"properties",title:__("Properties")}]},$layout=$(layoutTpl(data)),data=$(".log-browser .log-table-filters",$layout),$eventList=$(".log-browser .log-table",$layout),$eventViewer=$(".event-viewer",$layout),$exportLink=$(".js-export",$layout),filterRange=dateRangeFactory(data),currentFilter={
filtercolumns:{}};filterRange.on("submit reset",function(){$eventList.datatable("options",{params:{periodStart:this.getStart(),periodEnd:this.getEnd()}}),$eventList.datatable("refresh")}),$exportLink.on("click",function(){currentFilter.filtercolumns=_.merge(currentFilter.filtercolumns,{from:filterRange.getStart(),to:filterRange.getEnd()}),exporter({title:__("Export Log Entries"),exportUrl:url.route("export","TaoEventLog","taoEventLog",currentFilter)})}),$(".content").append($layout),$eventList.datatable({url:listUrl,sortby:"occurred",sortorder:"desc",filter:!0,rowSelection:!0,filterStrategy:"multiple",model:[{id:"identifier",label:__("ID"),
transform:function(id,row){return row.raw.id}},{id:"event_name",label:__("Event Name"),sortable:!0,filterable:!0},{id:"action",label:__("Action"),sortable:!0,filterable:!0},{id:"user_id",label:__("User ID"),sortable:!0,filterable:!0},{id:"user_roles",label:__("User Roles"),sortable:!0,filterable:!0,transform:function(roles){var result,rolesArray=roles.split(", "),rolesCount=rolesArray.length;return 1<rolesCount?result=currentFilter.filtercolumns.user_roles&&(rolesArray=_.find(rolesArray,function(item){return-1<item.toLowerCase().indexOf(currentFilter.filtercolumns.user_roles.toLowerCase())}))?__("%s and %s roles",rolesArray,rolesCount-1):__("%s roles",
rolesCount):1===rolesCount&&(result=roles),result}},{id:"occurred",label:__("Occurred"),sortable:!0}],listeners:{selected:function(e,event){!function(event){var key,json;for(key in event)event.hasOwnProperty(key)&&("properties"===key?(null!==(json=JSON.parse(event[key]))&&"object"!=typeof json&&(json=JSON.parse(json)),json=JSON.stringify(json,null,2),$("."+key,$eventViewer).html("<pre>"+json+"</pre>")):"user_roles"===key?$("."+key,$eventViewer).html(event.user_roles.split(",").join("<br>")):$("."+key,$eventViewer).html(event[key]))}(event.raw),$eventViewer.is(".hidden")&&($layout.find(".col-12").removeClass("col-12").addClass("col-7"),
$eventViewer.removeClass("hidden"))},filter:function(e,options){options.page=1},query:function(e,ajaxConfig){currentFilter=_.pick(ajaxConfig&&ajaxConfig.data,["filterquery","filtercolumns","sortby","sortorder","sorttype"])}}})}}}),define("taoEventLog/loader/taoEventLog.bundle",function(){});
//# sourceMappingURL=taoEventLog.min.js.map